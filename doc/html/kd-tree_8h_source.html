<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Kche-tree: kd-tree.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>kd-tree.h</h1><a href="kd-tree_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/***************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"> *   Copyright (C) 2010 by Leandro Graciá Gil                              *</span>
<a name="l00003"></a>00003 <span class="comment"> *   leandro.gracia.gil@gmail.com                                          *</span>
<a name="l00004"></a>00004 <span class="comment"> *                                                                         *</span>
<a name="l00005"></a>00005 <span class="comment"> *   This program is free software; you can redistribute it and/or modify  *</span>
<a name="l00006"></a>00006 <span class="comment"> *   it under the terms of the GNU General Public License as published by  *</span>
<a name="l00007"></a>00007 <span class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</span>
<a name="l00008"></a>00008 <span class="comment"> *   (at your option) any later version.                                   *</span>
<a name="l00009"></a>00009 <span class="comment"> *                                                                         *</span>
<a name="l00010"></a>00010 <span class="comment"> *   This program is distributed in the hope that it will be useful,       *</span>
<a name="l00011"></a>00011 <span class="comment"> *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *</span>
<a name="l00012"></a>00012 <span class="comment"> *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *</span>
<a name="l00013"></a>00013 <span class="comment"> *   GNU General Public License for more details.                          *</span>
<a name="l00014"></a>00014 <span class="comment"> *                                                                         *</span>
<a name="l00015"></a>00015 <span class="comment"> *   You should have received a copy of the GNU General Public License     *</span>
<a name="l00016"></a>00016 <span class="comment"> *   along with this program; if not, write to the                         *</span>
<a name="l00017"></a>00017 <span class="comment"> *   Free Software Foundation, Inc.,                                       *</span>
<a name="l00018"></a>00018 <span class="comment"> *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *</span>
<a name="l00019"></a>00019 <span class="comment"> ***************************************************************************/</span>
<a name="l00020"></a>00020 
<a name="l00085"></a>00085 <span class="preprocessor">#ifndef _KD_TREE_H_</span>
<a name="l00086"></a>00086 <span class="preprocessor"></span><span class="preprocessor">#define _KD_TREE_H_</span>
<a name="l00087"></a>00087 <span class="preprocessor"></span>
<a name="l00088"></a>00088 <span class="comment">// Include STL vectors for K neighbours output</span>
<a name="l00089"></a>00089 <span class="preprocessor">#include &lt;vector&gt;</span>
<a name="l00090"></a>00090 
<a name="l00091"></a>00091 <span class="comment">// STL streams</span>
<a name="l00092"></a>00092 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00093"></a>00093 
<a name="l00094"></a>00094 <span class="comment">// Include k-neighbours containers (k-heaps and k-vectors)</span>
<a name="l00095"></a>00095 <span class="preprocessor">#include &quot;<a class="code" href="k-heap_8h.html" title="Template for k-heaps holding the best k elements (logarithmic).">k-heap.h</a>&quot;</span>
<a name="l00096"></a>00096 <span class="preprocessor">#include &quot;<a class="code" href="k-vector_8h.html" title="Template for k-vectors holding the best k elements (linear).">k-vector.h</a>&quot;</span>
<a name="l00097"></a>00097 
<a name="l00098"></a>00098 <span class="comment">// Include template for feature vectors</span>
<a name="l00099"></a>00099 <span class="preprocessor">#include &quot;<a class="code" href="feature__vector_8h.html" title="Template for generic D-dimensional feature vectors.">feature_vector.h</a>&quot;</span>
<a name="l00100"></a>00100 
<a name="l00101"></a>00101 
<a name="l00113"></a>00113 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, const <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> D, <span class="keyword">typename</span> S = k_vector&lt;vector_distance&lt;T&gt;, vector_distance&lt;T&gt; &gt; &gt;
<a name="l00114"></a><a class="code" href="classkd__tree.html">00114</a> <span class="keyword">class </span><a class="code" href="classkd__tree.html" title="Template for generic cache-aware kd-trees of any type.">kd_tree</a> {
<a name="l00115"></a>00115 <span class="keyword">public</span>:
<a name="l00117"></a><a class="code" href="classkd__tree.html#afeb5e3cab4da767202cd0725ba90d5ee">00117</a>         <span class="keyword">typedef</span> <a class="code" href="structfeature__vector.html" title="Template for D-dimensional feature vectors.">feature_vector&lt;T, D&gt;</a> <a class="code" href="structfeature__vector.html" title="Template for D-dimensional feature vectors.">kd_point</a>;
<a name="l00118"></a>00118 
<a name="l00120"></a><a class="code" href="classkd__tree.html#a80af6e6794e0bf90e21039396c6b6fe7">00120</a>         <span class="keyword">typedef</span> <a class="code" href="structvector__distance.html" title="Vector-distance structure. References a feature vector by its index and its squared...">vector_distance&lt;T&gt;</a> <a class="code" href="structvector__distance.html" title="Vector-distance structure. References a feature vector by its index and its squared...">kd_neighbour</a>;
<a name="l00121"></a>00121 
<a name="l00122"></a>00122         <span class="comment">// Constructors and destructors</span>
<a name="l00123"></a>00123         <a class="code" href="classkd__tree.html#af0214253a5a1633fdcc29f121ed51563" title="Default constructor. Creates an empty and uninitialized kd-tree.">kd_tree</a>();      
<a name="l00124"></a>00124         <a class="code" href="classkd__tree.html#a8b57370b33e690fe843111fdcb0f5075" title="Default destructor.">~kd_tree</a>();     
<a name="l00125"></a>00125         
<a name="l00126"></a>00126         <span class="comment">// Basic kd-tree operations</span>
<a name="l00127"></a>00127         <span class="keywordtype">bool</span> <a class="code" href="classkd__tree.html#a377902de21fd685725c460582cfcc1a4" title="Build a kd-tree from a set of input points. Cost: O(n log² n).">build</a>(<span class="keyword">const</span> <a class="code" href="structfeature__vector.html" title="Template for D-dimensional feature vectors.">kd_point</a> *points, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> num_points, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> bucket_size = 32);                     
<a name="l00128"></a>00128         <span class="keywordtype">void</span> <a class="code" href="classkd__tree.html#aa288d7c126fbd325c81dc0605879d40b" title="Get the K nearest neighbours of a point. Estimated average cost: O(log K log n).">knn</a>(<span class="keyword">const</span> <a class="code" href="structfeature__vector.html" title="Template for D-dimensional feature vectors.">kd_point</a> &amp;p, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> K, std::vector&lt;kd_neighbour&gt; &amp;output, T epsilon = (T) 0) <span class="keyword">const</span>;        
<a name="l00129"></a>00129         <span class="keywordtype">void</span> <a class="code" href="classkd__tree.html#a9f4a85df883367be13593b29b4a33040" title="Get all neighbours within a distance from a point. Estimated average Cost: O(log...">all_in_range</a>(<span class="keyword">const</span> <a class="code" href="structfeature__vector.html" title="Template for D-dimensional feature vectors.">kd_point</a> &amp;p, T distance, std::vector&lt;kd_neighbour&gt; &amp;output) <span class="keyword">const</span>;                      
<a name="l00130"></a>00130 
<a name="l00132"></a><a class="code" href="classkd__tree.html#ab888b0010858415db49991bcd111e204">00132</a>         <span class="keyword">const</span> T &amp; <a class="code" href="classkd__tree.html#ab888b0010858415db49991bcd111e204" title="Subscript operator for accesing stored data.">operator [] </a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> index)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classkd__tree.html#a13bb048566fd405d8dbfab17b8d9d7f6" title="Data of the kd-tree. Copied with element permutations during the tree building.">data</a>[<a class="code" href="classkd__tree.html#a56787f008f66b21739862e0f66259a2b" title="Permutation indices applied to kd-tree data to enhance cache behaviour.">permutation</a>[index]]; }
<a name="l00133"></a>00133 
<a name="l00134"></a>00134         <span class="comment">// Stream operators</span>
<a name="l00135"></a>00135         <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T_, const <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> D_, <span class="keyword">typename</span> S_&gt;
<a name="l00136"></a>00136         <span class="keyword">friend</span> std::istream &amp; <a class="code" href="classkd__tree.html#a038efb2ca926733bd3d88455a342cd5b" title="Input operator (read from stream). Throws an exception in case of error.">operator &gt;&gt; </a>(std::istream &amp;in, <a class="code" href="classkd__tree.html" title="Template for generic cache-aware kd-trees of any type.">kd_tree&lt;T_, D_, S_&gt;</a> &amp;kdtree);              
<a name="l00137"></a>00137 
<a name="l00138"></a>00138         <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T_, const <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> D_, <span class="keyword">typename</span> S_&gt;
<a name="l00139"></a>00139         <span class="keyword">friend</span> std::ostream &amp; operator &lt;&lt; (std::ostream &amp;out, const kd_tree&lt;T_, D_, S_&gt; &amp;kdtree);       
<a name="l00140"></a>00140 
<a name="l00141"></a>00141         <span class="comment">// Kd-tree properties</span>
<a name="l00142"></a><a class="code" href="classkd__tree.html#ad71a29c2baafd30cc867c69a2799ddfc">00142</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="classkd__tree.html#ad71a29c2baafd30cc867c69a2799ddfc" title="Get the number of dimensions of the input data.">get_D</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="example_8cpp.html#aab36b7f3966dcaeea1db0699a6054709" title="Number of dimensions to use in this test.">D</a>; }                        
<a name="l00143"></a><a class="code" href="classkd__tree.html#a144f5d7f75bc8beaeced675cadc64fc7">00143</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="classkd__tree.html#a144f5d7f75bc8beaeced675cadc64fc7" title="Get the number of elements stored in the tree.">get_N</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classkd__tree.html#a11a342b531f7ac54924c14c88e38e8fe" title="Number of elements currently in the tree.">num_elements</a>; }             
<a name="l00144"></a>00144 
<a name="l00145"></a>00145 <span class="keyword">protected</span>:
<a name="l00146"></a>00146 
<a name="l00148"></a><a class="code" href="structkd__tree_1_1kd__search__data.html">00148</a>         <span class="keyword">struct </span><a class="code" href="structkd__tree_1_1kd__search__data.html" title="Structure holding data for incremental hyperrectangle-hypersphere intersection and...">kd_search_data</a> {
<a name="l00149"></a>00149                 
<a name="l00150"></a><a class="code" href="structkd__tree_1_1kd__search__data.html#a46665ab21716d4f9009273fd01e8b1e2">00150</a>                 <span class="keyword">const</span> <a class="code" href="structfeature__vector.html" title="Template for D-dimensional feature vectors.">kd_point</a> &amp;p;      
<a name="l00151"></a><a class="code" href="structkd__tree_1_1kd__search__data.html#ac0754dea4ac3d54f1e9add2bde393aa7">00151</a>                 <span class="keyword">const</span> <a class="code" href="structfeature__vector.html" title="Template for D-dimensional feature vectors.">kd_point</a> *<a class="code" href="structkd__tree_1_1kd__search__data.html#ac0754dea4ac3d54f1e9add2bde393aa7" title="Pointer to permutated data array.">data</a>;   
<a name="l00152"></a><a class="code" href="structkd__tree_1_1kd__search__data.html#a5d9484938e2ef5ca6c7e5b6ecaa94cf7">00152</a>                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> K;         
<a name="l00153"></a>00153 
<a name="l00154"></a><a class="code" href="structkd__tree_1_1kd__search__data.html#a9a60d4e47ae59cc89659803b25370ee0">00154</a>                 T <a class="code" href="structkd__tree_1_1kd__search__data.html#a9a60d4e47ae59cc89659803b25370ee0" title="Distance to the current nearest point in the hyperrectangle.">hyperrect_distance</a>;   
<a name="l00155"></a><a class="code" href="structkd__tree_1_1kd__search__data.html#af64d340fb4855bfa04ebc04fa0dede38">00155</a>                 T <a class="code" href="structkd__tree_1_1kd__search__data.html#af64d340fb4855bfa04ebc04fa0dede38" title="Current distance from the farthest nearest neighbour to the reference point.">farthest_distance</a>;    
<a name="l00156"></a>00156 
<a name="l00158"></a><a class="code" href="structkd__tree_1_1kd__search__data_1_1axis__data.html">00158</a>                 <span class="keyword">struct </span><a class="code" href="structkd__tree_1_1kd__search__data_1_1axis__data.html" title="Axis-ordered point and hyperrectangle structure. Used internally to increase the...">axis_data</a> {
<a name="l00159"></a><a class="code" href="structkd__tree_1_1kd__search__data_1_1axis__data.html#a0077eb363fe26ff59b0f9ddb30156118">00159</a>                         T p;            
<a name="l00160"></a><a class="code" href="structkd__tree_1_1kd__search__data_1_1axis__data.html#aad7d23729e945f660be952d0b5d06570">00160</a>                         T <a class="code" href="structkd__tree_1_1kd__search__data_1_1axis__data.html#aad7d23729e945f660be952d0b5d06570" title="Per-axis nearest point in the current hyperrectangle.">nearest</a>;      
<a name="l00161"></a>00161                 } <a class="code" href="structkd__tree_1_1kd__search__data.html#a814478c5469d544dc806158eb0b420d7" title="Axis-ordered point and hyperrectangle structure. Used internally to increase the...">axis</a>[<a class="code" href="example_8cpp.html#aab36b7f3966dcaeea1db0699a6054709" title="Number of dimensions to use in this test.">D</a>];              
<a name="l00162"></a>00162 
<a name="l00164"></a>00164                 <a class="code" href="structkd__tree_1_1kd__search__data.html#ac8946a58633a60480a95d5907552bb22" title="Initialize data for a tree search with incremental intersection calculation.">kd_search_data</a>(<span class="keyword">const</span> <a class="code" href="structfeature__vector.html" title="Template for D-dimensional feature vectors.">kd_point</a> &amp;p, <span class="keyword">const</span> <a class="code" href="structfeature__vector.html" title="Template for D-dimensional feature vectors.">kd_point</a> *<a class="code" href="structkd__tree_1_1kd__search__data.html#ac0754dea4ac3d54f1e9add2bde393aa7" title="Pointer to permutated data array.">data</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> K);
<a name="l00165"></a>00165         };
<a name="l00166"></a>00166 
<a name="l00168"></a><a class="code" href="structkd__tree_1_1kd__leaf.html">00168</a>         <span class="keyword">struct </span><a class="code" href="structkd__tree_1_1kd__leaf.html" title="Kd-tree leaf node.">kd_leaf</a> {
<a name="l00169"></a><a class="code" href="structkd__tree_1_1kd__leaf.html#a0095b31470f5b111167f449f157f9b2c">00169</a>                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structkd__tree_1_1kd__leaf.html#a0095b31470f5b111167f449f157f9b2c" title="Index of the first element contained by the leaf node.">first_index</a>;       
<a name="l00170"></a><a class="code" href="structkd__tree_1_1kd__leaf.html#aa45cbf945970dd0c4d6beec8ae2f7916">00170</a>                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structkd__tree_1_1kd__leaf.html#aa45cbf945970dd0c4d6beec8ae2f7916" title="Number of elements contained by the node.">num_elements</a>;      
<a name="l00171"></a>00171 
<a name="l00173"></a><a class="code" href="structkd__tree_1_1kd__leaf.html#a360b008063fc8593f06248656cccef46">00173</a>                 <a class="code" href="structkd__tree_1_1kd__leaf.html#a360b008063fc8593f06248656cccef46" title="Leaf constructor.">kd_leaf</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structkd__tree_1_1kd__leaf.html#a0095b31470f5b111167f449f157f9b2c" title="Index of the first element contained by the leaf node.">first_index</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structkd__tree_1_1kd__leaf.html#aa45cbf945970dd0c4d6beec8ae2f7916" title="Number of elements contained by the node.">num_elements</a>) :
<a name="l00174"></a>00174                         first_index(first_index), num_elements(num_elements) {}
<a name="l00175"></a>00175 
<a name="l00177"></a>00177                 <a class="code" href="structkd__tree_1_1kd__leaf.html#a360b008063fc8593f06248656cccef46" title="Leaf constructor.">kd_leaf</a>(std::istream &amp;input);
<a name="l00178"></a>00178 
<a name="l00180"></a>00180                 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> C&gt; <span class="keywordtype">void</span> <a class="code" href="structkd__tree_1_1kd__leaf.html#a92f4fe6b9dff39fcd105824bb9985526" title="Process a leaf node with many buckets on it. Do not use any upper bounds on distance...">explore</a>(<a class="code" href="structkd__tree_1_1kd__search__data.html" title="Structure holding data for incremental hyperrectangle-hypersphere intersection and...">kd_search_data</a> &amp;<a class="code" href="classkd__tree.html#a13bb048566fd405d8dbfab17b8d9d7f6" title="Data of the kd-tree. Copied with element permutations during the tree building.">data</a>, C &amp;candidates) <span class="keyword">const</span>;
<a name="l00181"></a>00181 
<a name="l00183"></a>00183                 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> C&gt; <span class="keywordtype">void</span> <a class="code" href="structkd__tree_1_1kd__leaf.html#a892ed1ed0506652e3fb99494ad6b5d22" title="Process a leaf node with many buckets on it. Allows partial distance calculations...">intersect</a>(<a class="code" href="structkd__tree_1_1kd__search__data.html" title="Structure holding data for incremental hyperrectangle-hypersphere intersection and...">kd_search_data</a> &amp;<a class="code" href="classkd__tree.html#a13bb048566fd405d8dbfab17b8d9d7f6" title="Data of the kd-tree. Copied with element permutations during the tree building.">data</a>, C &amp;candidates) <span class="keyword">const</span>;
<a name="l00184"></a>00184         
<a name="l00186"></a>00186                 <span class="keywordtype">bool</span> <a class="code" href="structkd__tree_1_1kd__leaf.html#a3fc24547815298a4f9c524a1110d660c" title="Write to stream.">write_to_binary_stream</a>(std::ostream &amp;out);
<a name="l00187"></a>00187         };
<a name="l00188"></a>00188 
<a name="l00190"></a><a class="code" href="structkd__tree_1_1kd__node.html">00190</a>         <span class="keyword">struct </span><a class="code" href="structkd__tree_1_1kd__node.html" title="Kd-tree branch node.">kd_node</a> {
<a name="l00191"></a>00191 
<a name="l00192"></a>00192                 <span class="keyword">union </span>{
<a name="l00193"></a><a class="code" href="structkd__tree_1_1kd__node.html#a575ca7591e57126f0b2599dbcaa4fa0d">00193</a>                         <a class="code" href="structkd__tree_1_1kd__node.html" title="Kd-tree branch node.">kd_node</a> *<a class="code" href="structkd__tree_1_1kd__node.html#a575ca7591e57126f0b2599dbcaa4fa0d" title="Left branch.">left_branch</a>;   
<a name="l00194"></a><a class="code" href="structkd__tree_1_1kd__node.html#a58b803caeda2ca85a7d926d32689c20b">00194</a>                         <a class="code" href="structkd__tree_1_1kd__leaf.html" title="Kd-tree leaf node.">kd_leaf</a> *<a class="code" href="structkd__tree_1_1kd__node.html#a58b803caeda2ca85a7d926d32689c20b" title="Left leaf.">left_leaf</a>;     
<a name="l00195"></a>00195                 };
<a name="l00196"></a>00196 
<a name="l00197"></a>00197                 <span class="keyword">union </span>{
<a name="l00198"></a><a class="code" href="structkd__tree_1_1kd__node.html#aee53d644e458497921d66636759be92b">00198</a>                         <a class="code" href="structkd__tree_1_1kd__node.html" title="Kd-tree branch node.">kd_node</a> *<a class="code" href="structkd__tree_1_1kd__node.html#aee53d644e458497921d66636759be92b" title="Right branch.">right_branch</a>;  
<a name="l00199"></a><a class="code" href="structkd__tree_1_1kd__node.html#a1ded083c1e27d77804faf51014998e13">00199</a>                         <a class="code" href="structkd__tree_1_1kd__leaf.html" title="Kd-tree leaf node.">kd_leaf</a> *<a class="code" href="structkd__tree_1_1kd__node.html#a1ded083c1e27d77804faf51014998e13" title="Right leaf.">right_leaf</a>;    
<a name="l00200"></a>00200                 };
<a name="l00201"></a>00201                 
<a name="l00202"></a><a class="code" href="structkd__tree_1_1kd__node.html#a16e03e0480016e7c99a020a07570eaf8">00202</a>                 T <a class="code" href="structkd__tree_1_1kd__node.html#a16e03e0480016e7c99a020a07570eaf8" title="Value used to split the hyperspace in two.">split_value</a>;                  
<a name="l00203"></a>00203 
<a name="l00204"></a>00204                 <span class="comment">// The leaf flags use the two uppermost bits of the axis index. Won&#39;t handle more than 2^30 dimensions.</span>
<a name="l00205"></a>00205                 <span class="keyword">union </span>{
<a name="l00206"></a><a class="code" href="structkd__tree_1_1kd__node.html#a1c34f43396b89ff30b3db0b173b55d6f">00206</a>                         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structkd__tree_1_1kd__node.html#a1c34f43396b89ff30b3db0b173b55d6f" title="Index of the current axis being split.">axis</a>;              
<a name="l00207"></a><a class="code" href="structkd__tree_1_1kd__node.html#a2ceaadd026e00c2aba950a3bd3ae2400">00207</a>                         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structkd__tree_1_1kd__node.html#a2ceaadd026e00c2aba950a3bd3ae2400" title="Bitmask used to check if left and right nodes are leafs or branches.">is_leaf</a>;           
<a name="l00208"></a>00208                 };
<a name="l00209"></a>00209 
<a name="l00210"></a>00210                 <span class="comment">// Bit masks to access the leaf and axis information</span>
<a name="l00211"></a><a class="code" href="structkd__tree_1_1kd__node.html#ac075fb938363170654dae43fd4e408a6">00211</a>                 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structkd__tree_1_1kd__node.html#ac075fb938363170654dae43fd4e408a6" title="Mask used to access the left branch bit in is_leaf.">left_bit</a>  = 0x80000000U;      
<a name="l00212"></a><a class="code" href="structkd__tree_1_1kd__node.html#a801a355ae57ca13fa6d16366d6921be2">00212</a>                 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structkd__tree_1_1kd__node.html#a801a355ae57ca13fa6d16366d6921be2" title="Mask used to access the right branch bit in is_leaf.">right_bit</a> = 0x40000000U;      
<a name="l00213"></a><a class="code" href="structkd__tree_1_1kd__node.html#a9403a72363aa78c82af538be5bb26b4d">00213</a>                 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structkd__tree_1_1kd__node.html#a9403a72363aa78c82af538be5bb26b4d" title="Mask used to access the axis bits.">axis_mask</a> = 0x3FFFFFFFU;      
<a name="l00214"></a>00214 
<a name="l00215"></a>00215                 <span class="comment">// Constructors and destructor</span>
<a name="l00216"></a><a class="code" href="structkd__tree_1_1kd__node.html#a6c4fcc220c8eac05edf7bc0f669d1d6a">00216</a>                 <a class="code" href="structkd__tree_1_1kd__node.html#a6c4fcc220c8eac05edf7bc0f669d1d6a" title="Default constructor.">kd_node</a>() : <a class="code" href="structkd__tree_1_1kd__node.html#a575ca7591e57126f0b2599dbcaa4fa0d" title="Left branch.">left_branch</a>(NULL), <a class="code" href="structkd__tree_1_1kd__node.html#aee53d644e458497921d66636759be92b" title="Right branch.">right_branch</a>(NULL), <a class="code" href="structkd__tree_1_1kd__node.html#a2ceaadd026e00c2aba950a3bd3ae2400" title="Bitmask used to check if left and right nodes are leafs or branches.">is_leaf</a>(0) {}        
<a name="l00217"></a>00217                 <a class="code" href="structkd__tree_1_1kd__node.html#a6c4fcc220c8eac05edf7bc0f669d1d6a" title="Default constructor.">kd_node</a>(std::istream &amp;input);                                           
<a name="l00218"></a>00218                 <a class="code" href="structkd__tree_1_1kd__node.html#ad545ed905d455945e20dd9709d986262" title="Default destructor.">~kd_node</a>();                                                             
<a name="l00219"></a>00219 
<a name="l00221"></a><a class="code" href="structkd__tree_1_1kd__node_1_1kd__axis__comparer.html">00221</a>                 <span class="keyword">struct </span><a class="code" href="structkd__tree_1_1kd__node_1_1kd__axis__comparer.html" title="Per axis element comparison functor. Used to apply STL sorting algorithms to individual...">kd_axis_comparer</a> {
<a name="l00222"></a><a class="code" href="structkd__tree_1_1kd__node_1_1kd__axis__comparer.html#a20be0b50934820423ad067e537ee7b3c">00222</a>                         <span class="keyword">const</span> <a class="code" href="structfeature__vector.html" title="Template for D-dimensional feature vectors.">kd_point</a> *<a class="code" href="structkd__tree_1_1kd__node_1_1kd__axis__comparer.html#a20be0b50934820423ad067e537ee7b3c" title="Array of input data.">data</a>;           
<a name="l00223"></a><a class="code" href="structkd__tree_1_1kd__node_1_1kd__axis__comparer.html#a3b8c5a61729ecbe5bfddcd17257ff5dd">00223</a>                         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structkd__tree_1_1kd__node_1_1kd__axis__comparer.html#a3b8c5a61729ecbe5bfddcd17257ff5dd" title="Current axis used for sorting.">axis</a>;              
<a name="l00224"></a>00224 
<a name="l00226"></a><a class="code" href="structkd__tree_1_1kd__node_1_1kd__axis__comparer.html#a59910b19c82968c74b9c116090e625af">00226</a>                         <span class="keywordtype">bool</span> <a class="code" href="structkd__tree_1_1kd__node_1_1kd__axis__comparer.html#a59910b19c82968c74b9c116090e625af" title="Axis-th element comparison. Used to perform per-dimension data sorting.">operator () </a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> &amp;i1, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> &amp;i2)<span class="keyword"> const </span>{
<a name="l00227"></a>00227                                 <span class="keywordflow">return</span> <a class="code" href="structkd__tree_1_1kd__node_1_1kd__axis__comparer.html#a20be0b50934820423ad067e537ee7b3c" title="Array of input data.">data</a>[i1][<a class="code" href="structkd__tree_1_1kd__node_1_1kd__axis__comparer.html#a3b8c5a61729ecbe5bfddcd17257ff5dd" title="Current axis used for sorting.">axis</a>] &lt; <a class="code" href="structkd__tree_1_1kd__node_1_1kd__axis__comparer.html#a20be0b50934820423ad067e537ee7b3c" title="Array of input data.">data</a>[i2][<a class="code" href="structkd__tree_1_1kd__node_1_1kd__axis__comparer.html#a3b8c5a61729ecbe5bfddcd17257ff5dd" title="Current axis used for sorting.">axis</a>];
<a name="l00228"></a>00228                         }
<a name="l00229"></a>00229                 };
<a name="l00230"></a>00230 
<a name="l00231"></a>00231                 <span class="comment">// --- Training-related --- //</span>
<a name="l00232"></a>00232 
<a name="l00234"></a>00234                 <span class="keyword">static</span> <a class="code" href="structkd__tree_1_1kd__node.html" title="Kd-tree branch node.">kd_node</a> *<a class="code" href="structkd__tree_1_1kd__node.html#a03ccfd2b1265da6b8c1abb0b069c43cd" title="Build the kd-tree recursively.">build</a>(<span class="keyword">const</span> <a class="code" href="structfeature__vector.html" title="Template for D-dimensional feature vectors.">kd_point</a> *<a class="code" href="classkd__tree.html#a13bb048566fd405d8dbfab17b8d9d7f6" title="Data of the kd-tree. Copied with element permutations during the tree building.">data</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *index, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n,
<a name="l00235"></a>00235                                       <a class="code" href="structkd__tree_1_1kd__node.html" title="Kd-tree branch node.">kd_node</a> *parent, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> bucket_size, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> &amp;processed);
<a name="l00236"></a>00236 
<a name="l00238"></a>00238                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structkd__tree_1_1kd__node.html#af98edf950268c299f4ae6ec3895a0125" title="Find a pivot to split the space in two by a chosen dimension during training.">split</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *index, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n, <span class="keyword">const</span> kd_axis_comparer &amp;comparer);
<a name="l00239"></a>00239 
<a name="l00240"></a>00240                 <span class="comment">// --- Search-related --- //</span>
<a name="l00241"></a>00241 
<a name="l00243"></a>00243                 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> C&gt; <span class="keywordtype">void</span> <a class="code" href="structkd__tree_1_1kd__node.html#ab24a421deb5ac32a2eca67ec7e026c1c" title="Traverse the kd-tree looking for nearest neighbours candidates based on Manhattan...">explore</a>(<span class="keyword">const</span> <a class="code" href="structkd__tree_1_1kd__node.html" title="Kd-tree branch node.">kd_node</a> *parent, <a class="code" href="structkd__tree_1_1kd__search__data.html" title="Structure holding data for incremental hyperrectangle-hypersphere intersection and...">kd_search_data</a> &amp;<a class="code" href="classkd__tree.html#a13bb048566fd405d8dbfab17b8d9d7f6" title="Data of the kd-tree. Copied with element permutations during the tree building.">data</a>, C &amp;candidates) <span class="keyword">const</span>;
<a name="l00244"></a>00244 
<a name="l00246"></a>00246                 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> C&gt; <span class="keywordtype">void</span> <a class="code" href="structkd__tree_1_1kd__node.html#a4b9f265758293b64c10e593a33aba8fd" title="Traverse the kd-tree checking hypersphere-hyperrectangle intersections to discard...">intersect</a>(<span class="keyword">const</span> <a class="code" href="structkd__tree_1_1kd__node.html" title="Kd-tree branch node.">kd_node</a> *parent, <a class="code" href="structkd__tree_1_1kd__search__data.html" title="Structure holding data for incremental hyperrectangle-hypersphere intersection and...">kd_search_data</a> &amp;<a class="code" href="classkd__tree.html#a13bb048566fd405d8dbfab17b8d9d7f6" title="Data of the kd-tree. Copied with element permutations during the tree building.">data</a>, C &amp;candidates) <span class="keyword">const</span>;
<a name="l00247"></a>00247 
<a name="l00248"></a>00248                 <span class="comment">// --- IO-related --- //</span>
<a name="l00249"></a>00249 
<a name="l00251"></a>00251                 <span class="keywordtype">bool</span> <a class="code" href="structkd__tree_1_1kd__node.html#a8372a2160d7372f615dbfd00a9d1832e" title="Write to stream.">write_to_binary_stream</a>(std::ostream &amp;out);
<a name="l00252"></a>00252         };
<a name="l00253"></a>00253         
<a name="l00255"></a><a class="code" href="classkd__tree_1_1kd__incremental.html">00255</a>         <span class="keyword">class </span><a class="code" href="classkd__tree_1_1kd__incremental.html" title="Incremental hyperrectangle-hypersphere intersection calculator. Designed so that...">kd_incremental</a> {
<a name="l00256"></a>00256         <span class="keyword">public</span>:
<a name="l00258"></a>00258                 <a class="code" href="classkd__tree_1_1kd__incremental.html#a5ebefec198068fd9a849462d63aadbca" title="Create an temporary incremental calculator object. Will update the current data according...">kd_incremental</a>(<span class="keyword">const</span> <a class="code" href="structkd__tree_1_1kd__node.html" title="Kd-tree branch node.">kd_node</a> *node, <span class="keyword">const</span> <a class="code" href="structkd__tree_1_1kd__node.html" title="Kd-tree branch node.">kd_node</a> *parent, <a class="code" href="structkd__tree_1_1kd__search__data.html" title="Structure holding data for incremental hyperrectangle-hypersphere intersection and...">kd_search_data</a> &amp;<a class="code" href="classkd__tree.html#a13bb048566fd405d8dbfab17b8d9d7f6" title="Data of the kd-tree. Copied with element permutations during the tree building.">data</a>);
<a name="l00259"></a>00259 
<a name="l00261"></a>00261                 <a class="code" href="classkd__tree_1_1kd__incremental.html#a0d7c62b9d0f49435272a81305ee91439" title="Destroy a temporary incremental calculator object. Will restore any previous modifications...">~kd_incremental</a>();
<a name="l00262"></a>00262 
<a name="l00263"></a>00263         <span class="keyword">protected</span>:
<a name="l00264"></a>00264 
<a name="l00265"></a><a class="code" href="classkd__tree_1_1kd__incremental.html#ae304471928937cb7babb50765c097fbf">00265</a>                 <a class="code" href="structkd__tree_1_1kd__search__data.html" title="Structure holding data for incremental hyperrectangle-hypersphere intersection and...">kd_search_data</a> &amp;<a class="code" href="classkd__tree_1_1kd__incremental.html#ae304471928937cb7babb50765c097fbf" title="Reference to the search data being used.">search_data</a>;    
<a name="l00266"></a><a class="code" href="classkd__tree_1_1kd__incremental.html#abc72e2b472d26de29b27fec4afee097c">00266</a>                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="classkd__tree_1_1kd__incremental.html#abc72e2b472d26de29b27fec4afee097c" title="Axis that defines the hyperspace splitting.">parent_axis</a>;       
<a name="l00267"></a>00267 
<a name="l00268"></a><a class="code" href="classkd__tree_1_1kd__incremental.html#a93d4bbf5f00edc792385bdfb6ce5e295">00268</a>                 T <a class="code" href="classkd__tree_1_1kd__incremental.html#a93d4bbf5f00edc792385bdfb6ce5e295" title="Previous value of the local axis in the hyperrectangle.">previous_axis_nearest</a>;        
<a name="l00269"></a><a class="code" href="classkd__tree_1_1kd__incremental.html#a407110bc2127ccba3ababc134d35ab8a">00269</a>                 T <a class="code" href="classkd__tree_1_1kd__incremental.html#a407110bc2127ccba3ababc134d35ab8a" title="Previous value of the distance to the nearest point in the hyperrectangle.">previous_hyperrect_distance</a>;  
<a name="l00270"></a>00270         };
<a name="l00271"></a>00271 
<a name="l00272"></a>00272         <span class="comment">// Internal methods</span>
<a name="l00273"></a>00273         <span class="keywordtype">void</span> <a class="code" href="classkd__tree.html#af4e388ca5b7b9f40c02a21bf56418355" title="Release memory allocated by the kd-tree including tree nodes.">release</a>();                 
<a name="l00274"></a>00274 
<a name="l00275"></a>00275         <span class="comment">// Kd-tree data</span>
<a name="l00276"></a><a class="code" href="classkd__tree.html#abdccd8f27531ed0c62f0eec7c17ca980">00276</a>         <a class="code" href="structkd__tree_1_1kd__node.html" title="Kd-tree branch node.">kd_node</a> *<a class="code" href="classkd__tree.html#abdccd8f27531ed0c62f0eec7c17ca980" title="Root node of the tree. Will be NULL in empty trees.">root</a>;                  
<a name="l00277"></a><a class="code" href="classkd__tree.html#a13bb048566fd405d8dbfab17b8d9d7f6">00277</a>         <a class="code" href="structfeature__vector.html" title="Template for D-dimensional feature vectors.">kd_point</a> *<a class="code" href="classkd__tree.html#a13bb048566fd405d8dbfab17b8d9d7f6" title="Data of the kd-tree. Copied with element permutations during the tree building.">data</a>;                 
<a name="l00278"></a><a class="code" href="classkd__tree.html#a56787f008f66b21739862e0f66259a2b">00278</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *<a class="code" href="classkd__tree.html#a56787f008f66b21739862e0f66259a2b" title="Permutation indices applied to kd-tree data to enhance cache behaviour.">permutation</a>;      
<a name="l00279"></a><a class="code" href="classkd__tree.html#a11a342b531f7ac54924c14c88e38e8fe">00279</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="classkd__tree.html#a11a342b531f7ac54924c14c88e38e8fe" title="Number of elements currently in the tree.">num_elements</a>;      
<a name="l00280"></a>00280 
<a name="l00281"></a>00281         <span class="comment">// File serialization settings</span>
<a name="l00282"></a><a class="code" href="classkd__tree.html#a29c05c444a1ae7dc9039572be0e1d6ec">00282</a>         <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="classkd__tree.html#a29c05c444a1ae7dc9039572be0e1d6ec" title="Header written when serializing kd-trees.">file_header</a>;                 
<a name="l00283"></a><a class="code" href="classkd__tree.html#a25c58527f6f239a21fb0876e264bc792">00283</a>         <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="classkd__tree.html#a25c58527f6f239a21fb0876e264bc792" title="Length in bytes of the header.">file_header_length</a>; 
<a name="l00284"></a><a class="code" href="classkd__tree.html#a863ec144d22da305a0892d35a4c07320">00284</a>         <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="classkd__tree.html#a863ec144d22da305a0892d35a4c07320" title="Tuple of major and minor version of the current kd-tree file format.">file_version</a>[2];    
<a name="l00285"></a><a class="code" href="classkd__tree.html#a5e26617f237511ddd6dac86bcc2ad8f8">00285</a>         <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="classkd__tree.html#a5e26617f237511ddd6dac86bcc2ad8f8" title="Signature value used to check the end of file according to the format.">signature</a>;          
<a name="l00286"></a>00286 };
<a name="l00287"></a>00287 
<a name="l00288"></a>00288 <span class="comment">// Template implementation</span>
<a name="l00289"></a>00289 <span class="preprocessor">#include &quot;<a class="code" href="kd-tree_8cpp.html" title="Template implementations for generic kd-trees.">kd-tree.cpp</a>&quot;</span>
<a name="l00290"></a>00290 <span class="preprocessor">#include &quot;<a class="code" href="kd-tree__io_8cpp.html" title="Template implementations for stream operations in kd-trees.">kd-tree_io.cpp</a>&quot;</span>
<a name="l00291"></a>00291 
<a name="l00292"></a>00292 <span class="preprocessor">#endif</span>
<a name="l00293"></a>00293 <span class="preprocessor"></span>
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Wed Jun 23 17:55:50 2010 for Kche-tree by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
